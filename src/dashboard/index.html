<!DOCTYPE html>
<html lang="en" class="dark">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Imperium Flow | Command Center</title>
    <meta name="description" content="Real-time monitoring dashboard for Imperium Flow Agentic Workflow Orchestrator">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=JetBrains+Mono:wght@400;500;600&display=swap"
        rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           IMPERIUM FLOW â€” COMMAND CENTER DESIGN SYSTEM
           Dark Mode + Light Mode + Glassmorphism + Mobile First
           â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

        :root {
            /* Default Dark Mode Variables */
            --bg-deep: #06060b;
            --bg-primary: #0a0a12;
            --bg-secondary: #10101d;
            --bg-panel: rgba(16, 16, 29, 0.75);
            --bg-card: rgba(20, 20, 40, 0.6);

            --cyan: #00d4ff;
            --cyan-dim: rgba(0, 212, 255, 0.15);
            --cyan-glow: rgba(0, 212, 255, 0.4);
            --magenta: #ff006e;
            --magenta-dim: rgba(255, 0, 110, 0.15);
            --teal: #00f5d4;
            --teal-dim: rgba(0, 245, 212, 0.15);
            --amber: #ffb703;
            --amber-dim: rgba(255, 183, 3, 0.15);
            --purple: #8b5cf6;

            --text-primary: #e8e8f0;
            --text-secondary: #8888a0;
            --text-dim: #555570;
            --border: rgba(255, 255, 255, 0.06);

            --radius: 16px;
            --radius-sm: 10px;
            --radius-xs: 6px;
        }

        /* Light Mode Overrides */
        html.light {
            --bg-deep: #f0f2f5;
            --bg-primary: #ffffff;
            --bg-secondary: #f8f9fa;
            --bg-panel: rgba(255, 255, 255, 0.85);
            --bg-card: rgba(255, 255, 255, 0.95);

            --cyan: #00b4d8;
            --cyan-dim: rgba(0, 180, 216, 0.1);
            --cyan-glow: rgba(0, 180, 216, 0.2);
            --magenta: #d0005a;
            --magenta-dim: rgba(208, 0, 90, 0.1);
            --teal: #00a896;
            --teal-dim: rgba(0, 168, 150, 0.1);
            --amber: #fca311;
            --amber-dim: rgba(252, 163, 17, 0.1);
            --purple: #7209b7;

            --text-primary: #1a1a2e;
            --text-secondary: #4a5568;
            --text-dim: #718096;
            --border: rgba(0, 0, 0, 0.08);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: var(--bg-deep);
            color: var(--text-primary);
            font-family: 'Inter', -apple-system, sans-serif;
            min-height: 100vh;
            overflow-x: hidden;
            transition: background 0.3s ease, color 0.3s ease;
        }

        /* Animated background grid - only visible in dark mode or subtle in light */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background:
                radial-gradient(ellipse at 20% 20%, var(--cyan-dim) 0%, transparent 50%),
                radial-gradient(ellipse at 80% 80%, var(--magenta-dim) 0%, transparent 50%);
            pointer-events: none;
            z-index: 0;
            opacity: 0.5;
        }

        .glass-panel {
            background: var(--bg-panel);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            padding: 1.5rem;
            transition: all 0.3s ease;
        }

        .glass-panel:hover {
            border-color: var(--cyan);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
        }

        /* Mobile specific styles */
        @media (max-width: 768px) {
            .glass-panel {
                padding: 1rem;
                margin-bottom: 1rem;
            }

            .mobile-grid {
                display: grid;
                grid-template-columns: 1fr;
                gap: 1rem;
            }

            /* Horizontal Swipe for KPIs */
            .swipe-container {
                display: flex;
                overflow-x: auto;
                scroll-snap-type: x mandatory;
                -webkit-overflow-scrolling: touch;
                padding-bottom: 1rem;
                margin: 0 -1rem 1rem -1rem;
                padding: 0 1rem 1rem 1rem;
            }

            .swipe-item {
                scroll-snap-align: start;
                flex-shrink: 0;
                width: 85vw;
                margin-right: 1rem;
            }

            .nav-tabs {
                display: none;
                /* Hide desktop nav */
            }

            .mobile-nav {
                position: fixed;
                bottom: 0;
                left: 0;
                right: 0;
                background: var(--bg-primary);
                border-top: 1px solid var(--border);
                display: flex;
                justify-content: space-around;
                padding: 10px 0;
                z-index: 50;
                box-shadow: 0 -4px 20px rgba(0, 0, 0, 0.1);
            }
        }

        @media (min-width: 769px) {
            .mobile-nav {
                display: none;
            }

            .desktop-nav {
                display: flex;
            }

            .swipe-container {
                display: none;
            }

            /* Show grid instead */
            .kpi-grid-desktop {
                display: grid;
                grid-template-columns: repeat(4, 1fr);
                gap: 1.5rem;
                margin-bottom: 1.5rem;
            }
        }

        /* Chart Containers */
        .chart-container {
            position: relative;
            width: 100%;
            height: 200px;
        }

        @media (min-width: 768px) {
            .chart-container {
                height: 250px;
            }
        }

        /* Typography & Components */
        .kpi-value {
            font-family: 'JetBrains Mono', monospace;
            font-size: 2rem;
            font-weight: 700;
            line-height: 1;
        }

        .kpi-label {
            font-size: 0.75rem;
            font-weight: 500;
            color: var(--text-dim);
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-top: 0.5rem;
        }

        /* Pull to Refresh */
        .pull-refresh {
            position: fixed;
            top: 0;
            left: 50%;
            transform: translateX(-50%);
            z-index: 100;
            background: var(--bg-panel);
            border: 1px solid var(--border);
            border-top: none;
            border-radius: 0 0 12px 12px;
            padding: 8px 16px;
            font-size: 0.8rem;
            display: flex;
            align-items: center;
            gap: 8px;
            opacity: 0;
            transition: opacity 0.3s;
        }

        .pull-refresh.visible {
            opacity: 1;
        }

        /* Theme Toggle */
        .theme-btn {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--border);
            border-radius: 12px;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 1.2rem;
            color: var(--text-primary);
        }

        .theme-btn:hover {
            background: rgba(255, 255, 255, 0.1);
        }
    </style>
</head>

<body class="pb-20 lg:pb-8">

    <!-- Pull to Refresh Indicator -->
    <div id="pull-refresh" class="pull-refresh">
        <span style="color:var(--cyan)">â†»</span> Updating...
    </div>

    <div class="max-w-[1600px] mx-auto px-4 lg:px-6 pt-4 relative z-10">

        <!-- â•â•â• Header â•â•â• -->
        <header class="glass-panel flex justify-between items-center mb-6">
            <div class="flex items-center gap-4">
                <div
                    class="w-10 h-10 lg:w-12 lg:h-12 rounded-xl bg-gradient-to-br from-cyan-400 to-blue-600 flex items-center justify-center text-xl lg:text-2xl shadow-lg shadow-cyan-500/20 text-white">
                    âš¡
                </div>
                <div>
                    <h1 class="text-xl lg:text-2xl font-bold tracking-tight">IMPERIUM FLOW</h1>
                    <p class="text-xs lg:text-sm text-[var(--text-dim)] font-mono">Agentic Command Center</p>
                </div>
            </div>

            <div class="flex items-center gap-3 lg:gap-6">
                <!-- Desktop Nav -->
                <nav class="hidden lg:flex gap-2 p-1 bg-[var(--bg-secondary)] rounded-lg border border-[var(--border)]">
                    <button
                        class="px-4 py-2 rounded-md text-sm font-medium bg-[var(--cyan-dim)] text-[var(--cyan)]">Overview</button>
                    <button
                        class="px-4 py-2 rounded-md text-sm font-medium text-[var(--text-secondary)] hover:text-[var(--text-primary)]">Agents</button>
                    <button
                        class="px-4 py-2 rounded-md text-sm font-medium text-[var(--text-secondary)] hover:text-[var(--text-primary)]">Workflows</button>
                </nav>

                <!-- Status & Theme -->
                <div class="flex items-center gap-3">
                    <div
                        class="hidden sm:flex items-center gap-2 px-3 py-1.5 rounded-full bg-[var(--teal-dim)] border border-[var(--teal-dim)]">
                        <span class="w-2 h-2 rounded-full bg-[var(--teal)] animate-pulse"></span>
                        <span class="text-xs font-bold text-[var(--teal)]">LIVE</span>
                    </div>

                    <button id="theme-toggle" class="theme-btn">
                        ğŸŒ™
                    </button>
                </div>
            </div>
        </header>

        <!-- â•â•â• KPIs Section â•â•â• -->
        <!-- Mobile Swipe Container -->
        <div class="lg:hidden swipe-container">
            <div class="swipe-item glass-panel flex flex-col items-center justify-center text-center">
                <div class="kpi-value text-[var(--cyan)]" id="kpiTotalTasks">0</div>
                <div class="kpi-label">Total Tasks</div>
            </div>
            <div class="swipe-item glass-panel flex flex-col items-center justify-center text-center">
                <div class="kpi-value text-[var(--teal)]" id="kpiSuccessRate">0%</div>
                <div class="kpi-label">Success Rate</div>
            </div>
            <div class="swipe-item glass-panel flex flex-col items-center justify-center text-center">
                <div class="kpi-value text-[var(--amber)]" id="kpiActive">0</div>
                <div class="kpi-label">Active Tasks</div>
            </div>
            <div class="swipe-item glass-panel flex flex-col items-center justify-center text-center">
                <div class="kpi-value text-[var(--magenta)]" id="kpiFailures">0</div>
                <div class="kpi-label">Failures</div>
            </div>
        </div>

        <!-- Desktop KPI Grid -->
        <div class="kpi-grid-desktop hidden">
            <div class="glass-panel text-center hover:-translate-y-1 transition-transform cursor-default">
                <div class="kpi-value text-[var(--cyan)]" id="dtKpiTotal">0</div>
                <div class="kpi-label">Total Tasks</div>
            </div>
            <div class="glass-panel text-center hover:-translate-y-1 transition-transform cursor-default">
                <div class="kpi-value text-[var(--teal)]" id="dtKpiSuccess">0%</div>
                <div class="kpi-label">Success Rate</div>
            </div>
            <div class="glass-panel text-center hover:-translate-y-1 transition-transform cursor-default">
                <div class="kpi-value text-[var(--amber)]" id="dtKpiActive">0</div>
                <div class="kpi-label">Active Tasks</div>
            </div>
            <div class="glass-panel text-center hover:-translate-y-1 transition-transform cursor-default">
                <div class="kpi-value text-[var(--magenta)]" id="dtKpiFailures">0</div>
                <div class="kpi-label">Failures</div>
            </div>
        </div>

        <!-- â•â•â• Main Dashboard Grid â•â•â• -->
        <div class="grid grid-cols-1 lg:grid-cols-12 gap-6">

            <!-- Executive Summary & Health -->
            <div class="col-span-1 lg:col-span-3 glass-panel flex flex-col items-center">
                <h2
                    class="text-sm font-bold text-[var(--text-secondary)] tracking-widest uppercase mb-6 flex items-center gap-2">
                    <span>ğŸ¯</span> System Health
                </h2>
                <div class="relative w-40 h-24 mb-4">
                    <canvas id="healthGauge"></canvas>
                </div>
                <div class="text-3xl font-bold text-[var(--teal)] mb-1" id="healthScore">--%</div>
                <p class="text-xs text-[var(--text-dim)]">OPERATIONAL STATUS</p>

                <div class="w-full h-[1px] bg-[var(--border)] my-6"></div>

                <div class="w-full">
                    <h3 class="text-xs font-bold text-[var(--text-secondary)] mb-4">BOARD ACTIVITY</h3>
                    <div id="boardTimeline" class="space-y-4">
                        <!-- Dynamic Content -->
                    </div>
                </div>
            </div>

            <!-- Charts & Metrics -->
            <div class="col-span-1 lg:col-span-5 glass-panel">
                <h2
                    class="text-sm font-bold text-[var(--text-secondary)] tracking-widest uppercase mb-6 flex items-center gap-2">
                    <span>ğŸ“Š</span> Real-time Metrics
                </h2>
                <div class="chart-container mb-6">
                    <canvas id="successChart"></canvas>
                </div>
                <h3 class="text-xs font-bold text-[var(--text-secondary)] mb-2 mt-4">AGENT THROUGHPUT</h3>
                <div class="h-[150px] w-full relative">
                    <canvas id="throughputChart"></canvas>
                </div>
            </div>

            <!-- Agent Status -->
            <div class="col-span-1 lg:col-span-4 glass-panel">
                <h2
                    class="text-sm font-bold text-[var(--text-secondary)] tracking-widest uppercase mb-6 flex items-center gap-2">
                    <span>ğŸ¤–</span> Agent Status
                </h2>
                <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-1 gap-3" id="agentGrid">
                    <!-- Dynamic Agent Cards -->
                </div>
            </div>

            <!-- Workflow Pipeline (Full Width) -->
            <div class="col-span-1 lg:col-span-12 glass-panel">
                <h2
                    class="text-sm font-bold text-[var(--text-secondary)] tracking-widest uppercase mb-6 flex items-center gap-2">
                    <span>ğŸ”„</span> Workflow Pipeline
                </h2>
                <div id="workflowList" class="flex flex-col gap-3">
                    <!-- Dynamic Workflows -->
                </div>
            </div>

        </div>

    </div>

    <!-- Mobile Bottom Nav -->
    <nav class="mobile-nav">
        <button class="flex flex-col items-center gap-1 p-2 text-[var(--cyan)]">
            <span class="text-xl">ğŸ“Š</span>
            <span class="text-[10px] font-medium">Overview</span>
        </button>
        <button class="flex flex-col items-center gap-1 p-2 text-[var(--text-dim)]">
            <span class="text-xl">ğŸ¤–</span>
            <span class="text-[10px] font-medium">Agents</span>
        </button>
        <button class="flex flex-col items-center gap-1 p-2 text-[var(--text-dim)]">
            <span class="text-xl">âš¡</span>
            <span class="text-[10px] font-medium">Activity</span>
        </button>
        <button class="flex flex-col items-center gap-1 p-2 text-[var(--text-dim)]">
            <span class="text-xl">ğŸ§ </span>
            <span class="text-[10px] font-medium">Memory</span>
        </button>
    </nav>

    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
         JAVASCRIPT LOGIC
         â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <script>
        // â”€â”€ Theme Management â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        class ThemeManager {
            constructor() {
                this.currentTheme = localStorage.getItem('imperium-theme') || 'dark';
                this.toggleBtn = document.getElementById('theme-toggle');
                this.init();
            }

            init() {
                this.applyTheme(this.currentTheme);
                this.toggleBtn.addEventListener('click', () => this.toggle());
            }

            toggle() {
                const newTheme = this.currentTheme === 'dark' ? 'light' : 'dark';
                this.applyTheme(newTheme);
                this.currentTheme = newTheme;
                localStorage.setItem('imperium-theme', newTheme);
            }

            applyTheme(theme) {
                const html = document.documentElement;
                if (theme === 'dark') {
                    html.classList.remove('light');
                    html.classList.add('dark');
                    this.toggleBtn.textContent = 'ğŸŒ™';
                } else {
                    html.classList.remove('dark');
                    html.classList.add('light');
                    this.toggleBtn.textContent = 'â˜€ï¸';
                }

                // Update specific chart colors if needed
                setTimeout(() => this.updateCharts(), 50);
            }

            updateCharts() {
                // Trigger chart updates to pick up new CSS variables
                const textColor = getComputedStyle(document.body).getPropertyValue('--text-dim').trim();
                const gridColor = getComputedStyle(document.body).getPropertyValue('--border').trim();

                Chart.helpers.each(Chart.instances, (chart) => {
                    if (chart.options.scales.x) {
                        chart.options.scales.x.ticks.color = textColor;
                        chart.options.scales.x.grid.color = gridColor;
                    }
                    if (chart.options.scales.y) {
                        chart.options.scales.y.ticks.color = textColor;
                        chart.options.scales.y.grid.color = gridColor;
                    }
                    chart.update('none');
                });
            }
        }

        // â”€â”€ Mobile Interactions â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        let touchStartY = 0;
        document.addEventListener('touchstart', e => { touchStartY = e.changedTouches[0].screenY; }, { passive: true });
        document.addEventListener('touchend', e => {
            const touchEndY = e.changedTouches[0].screenY;
            if (touchStartY - touchEndY < -100 && window.scrollY === 0) {
                // Pull to refresh
                const indicator = document.getElementById('pull-refresh');
                indicator.classList.add('visible');
                setTimeout(() => {
                    fetchDashboard(); // Trigger refresh
                    indicator.classList.remove('visible');
                }, 1000);
            }
        }, { passive: true });

        // â”€â”€ Dashboard Logic (Integrated from previous) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        const AGENTS = {
            'CodeBot': { icon: 'ğŸ¤–', role: 'Dev', color: 'var(--cyan)' },
            'TestBot': { icon: 'ğŸ§ª', role: 'QA', color: 'var(--teal)' },
            'DesignBot': { icon: 'ğŸ¨', role: 'UI', color: 'var(--amber)' },
            'IntegrationBot': { icon: 'ğŸ”Œ', role: 'Ops', color: 'var(--magenta)' }
        };

        // Initialize Charts
        let successChart, throughputChart, healthGaugeChart;

        function initCharts() {
            // Success Line Chart
            const ctxSuccess = document.getElementById('successChart').getContext('2d');
            successChart = new Chart(ctxSuccess, {
                type: 'line',
                data: {
                    labels: Array(20).fill(''),
                    datasets: [{
                        data: Array(20).fill(0),
                        borderColor: '#00d4ff', // Will reference var in future
                        backgroundColor: 'rgba(0, 212, 255, 0.1)',
                        fill: true,
                        tension: 0.4,
                        pointRadius: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false } },
                    scales: { y: { min: 60, max: 100, display: true }, x: { display: false } }
                }
            });

            // Throughput Bar Chart
            const ctxTp = document.getElementById('throughputChart').getContext('2d');
            throughputChart = new Chart(ctxTp, {
                type: 'bar',
                data: {
                    labels: ['CodeBot', 'TestBot', 'DesignBot'],
                    datasets: [{
                        data: [0, 0, 0],
                        backgroundColor: ['#00d4ff', '#00f5d4', '#ffb703'],
                        borderRadius: 4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    indexAxis: 'y',
                    plugins: { legend: { display: false } },
                    scales: { x: { display: false }, y: { ticks: { color: '#8888a0' } } }
                }
            });

            // Health Gauge (Doughnut hack)
            const ctxHealth = document.getElementById('healthGauge').getContext('2d');
            healthGaugeChart = new Chart(ctxHealth, {
                type: 'doughnut',
                data: {
                    labels: ['Health', 'Gap'],
                    datasets: [{
                        data: [89, 11],
                        backgroundColor: ['#00f5d4', 'rgba(255,255,255,0.05)'],
                        borderWidth: 0,
                        circumference: 180,
                        rotation: 270
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    cutout: '85%',
                    plugins: { legend: { display: false }, tooltip: { enabled: false } }
                }
            });
        }

        // update UI with data
        function updateUI(data) {
            const ov = data.overview;
            if (!ov) return;

            // Update Text (Mobile + Desktop)
            ['kpiTotalTasks', 'dtKpiTotal'].forEach(id => {
                const el = document.getElementById(id); if (el) el.textContent = ov.total_tasks;
            });
            ['kpiSuccessRate', 'dtKpiSuccess'].forEach(id => {
                const el = document.getElementById(id); if (el) el.textContent = ov.overall_success_rate + '%';
            });
            ['kpiActive', 'dtKpiActive'].forEach(id => {
                const el = document.getElementById(id); if (el) el.textContent = ov.active_tasks;
            });
            ['kpiFailures', 'dtKpiFailures'].forEach(id => {
                const el = document.getElementById(id); if (el) el.textContent = ov.total_failures;
            });

            // Health Score
            document.getElementById('healthScore').textContent = ov.overall_success_rate + '%';
            if (healthGaugeChart) {
                healthGaugeChart.data.datasets[0].data = [ov.overall_success_rate, 100 - ov.overall_success_rate];
                healthGaugeChart.update();
            }

            // Charts
            if (successChart) {
                const currentData = successChart.data.datasets[0].data;
                currentData.shift();
                currentData.push(ov.overall_success_rate);
                successChart.update('none');
            }

            // Agents
            const agentContainer = document.getElementById('agentGrid');
            agentContainer.innerHTML = Object.entries(data.agents).map(([name, stats]) => {
                const meta = AGENTS[name] || { icon: 'ğŸ¤–', role: 'Agent', color: 'gray' };
                const rate = stats.success_rate || 0;
                return `
                    <div class="p-3 rounded-xl border border-[var(--border)] bg-[var(--bg-card)] flex items-center justify-between">
                        <div class="flex items-center gap-3">
                            <div class="text-2xl">${meta.icon}</div>
                            <div>
                                <div class="text-sm font-bold text-[var(--text-primary)]">${name}</div>
                                <div class="text-xs text-[var(--text-dim)]">${meta.role}</div>
                            </div>
                        </div>
                        <div class="text-right">
                            <div class="text-sm font-bold" style="color:${meta.color}">${rate}%</div>
                            <div class="text-xs text-[var(--text-dim)]">${stats.total_tasks} tasks</div>
                        </div>
                    </div>
                `;
            }).join('');

            // Workflow Pipeline
            const wfContainer = document.getElementById('workflowList');
            // Mock workflow data for display if none active
            const workflows = [
                { id: '#1251', name: 'Mobile API Integration', status: 'running', progress: 60 },
                { id: '#1250', name: 'Dark Mode UI Sync', status: 'completed', progress: 100 },
                { id: '#1249', name: 'User Auth Flow', status: 'completed', progress: 100 }
            ];

            wfContainer.innerHTML = workflows.map(wf => `
                <div class="flex items-center justify-between p-3 rounded-lg border border-[var(--border)] bg-[var(--bg-card)]">
                    <div class="flex items-center gap-3">
                        <span class="font-mono text-xs text-[var(--text-dim)]">${wf.id}</span>
                        <span class="text-sm font-medium text-[var(--text-primary)]">${wf.name}</span>
                    </div>
                    <div class="flex items-center gap-3">
                        <div class="w-24 h-1.5 bg-[var(--bg-deep)] rounded-full overflow-hidden hidden sm:block">
                            <div class="h-full bg-[var(--cyan)]" style="width: ${wf.progress}%"></div>
                        </div>
                        <span class="text-xs px-2 py-1 rounded bg-[var(--cyan-dim)] text-[var(--cyan)] font-bold uppercase">${wf.status}</span>
                    </div>
                </div>
            `).join('');

            // Board Timeline (Mock)
            document.getElementById('boardTimeline').innerHTML = `
                <div class="flex gap-3 text-xs">
                    <div class="w-2 h-2 mt-1 rounded-full bg-[var(--cyan)]"></div>
                    <div>
                        <span class="font-bold text-[var(--text-primary)]">CTO</span>
                        <span class="text-[var(--text-secondary)]"> approved Phase 18 release</span>
                        <div class="text-[var(--text-dim)] mt-0.5">2 min ago</div>
                    </div>
                </div>
                <div class="flex gap-3 text-xs">
                    <div class="w-2 h-2 mt-1 rounded-full bg-[var(--magenta)]"></div>
                    <div>
                        <span class="font-bold text-[var(--text-primary)]">CSO</span>
                        <span class="text-[var(--text-secondary)]"> flagged mobile API CORS policy</span>
                        <div class="text-[var(--text-dim)] mt-0.5">15 min ago</div>
                    </div>
                </div>
             `;
        }

        // â”€â”€ Initialization â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        const themeManager = new ThemeManager();
        initCharts();

        // Data Fetching
        async function fetchDashboard() {
            try {
                // Determine if mobile (simplified check)
                const isMobile = window.innerWidth < 768;
                const endpoint = isMobile ? '/api/mobile/summary' : '/api/dashboard';
                const resp = await fetch(endpoint);
                const data = await resp.json();

                // If mobile endpoint returns simplified structure, normalize it locally 
                // or just use standard endpoint for simplicity in this demo to keep UI consistent
                if (isMobile && data.kpi) {
                    // Adapt mobile summary to overview structure
                    updateUI({
                        overview: {
                            total_tasks: data.kpi.total,
                            overall_success_rate: data.kpi.success_rate,
                            active_tasks: data.kpi.active,
                            total_failures: data.kpi.failures
                        },
                        agents: data.agents.reduce((acc, curr) => {
                            acc[curr.name] = { success_rate: curr.rate, total_tasks: 0 };
                            return acc;
                        }, {})
                    });
                } else {
                    updateUI(data);
                }
            } catch (err) {
                console.log('Using demo data fallback');
                // Fallback demo data
                updateUI({
                    overview: { total_tasks: 88, overall_success_rate: 91.5, active_tasks: 5, total_failures: 8 },
                    agents: {
                        'CodeBot': { success_rate: 98, total_tasks: 35 },
                        'TestBot': { success_rate: 92, total_tasks: 28 },
                        'DesignBot': { success_rate: 89, total_tasks: 15 },
                        'IntegrationBot': { success_rate: 82, total_tasks: 10 }
                    }
                });
            }
        }

        // WebSockets
        const protocol = location.protocol === 'https:' ? 'wss:' : 'ws:';
        const ws = new WebSocket(`${protocol}//${location.host}/ws`);
        ws.onopen = () => console.log('WS Connected');
        ws.onmessage = (e) => {
            const data = JSON.parse(e.data);
            updateUI(data);
        };

        // Initial Fetch
        fetchDashboard();
        setInterval(fetchDashboard, 5000); // Polling fallback

    </script>
</body>

</html>